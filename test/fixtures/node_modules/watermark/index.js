var thr = require('through2')

module.exports = function watermark(b, opts) {
  opts = opts || {}
  opts.mark = opts.mark || 'DEPSIFY'

  b.on('reset', hook)
  hook()

  function hook() {
    b.pipeline.get('deps').push(thr.obj(function (row, _, next) {
      row.source += '\n/* ' + opts.mark + ' */\n'
      next(null, row)
    }))
  }
}

